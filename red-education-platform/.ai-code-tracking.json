{
  "version": "1.0",
  "records": [
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/resource/service/impl/ResourceServiceImpl.java",
      "timestamp": 1765252660277,
      "startOffset": 7422,
      "endOffset": 7862,
      "codeContent": "public void addDownloadCount(Long id) {\n        Resource resource \u003d resourceMapper.selectById(id);\n        if (resource !\u003d null) {\n            Integer currentCount \u003d resource.getDownloadCount();\n            resource.setDownloadCount(currentCount \u003d\u003d null ? 1 : currentCount + 1);\n            resourceMapper.updateById(resource);\n            log.info(\"资源{}下载量+1，当前下载量\u003d{}\", id, resource.getDownloadCount());\n        }\n    }\n\n    @Override\n    ",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 12
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/resource/controller/ResourceController.java",
      "timestamp": 1765252720368,
      "startOffset": 2930,
      "endOffset": 3266,
      "codeContent": "\n    @ApiOperation(\"下载资源\")\n    @PostMapping(\"/{id}/download\")\n    public Result\u003cString\u003e downloadResource(@PathVariable Long id) {\n        ResourceDetailVO resource \u003d resourceService.getResourceDetail(id);\n        // 增加下载量\n        resourceService.addDownloadCount(id);\n        return Result.success(\"下载成功\", resource.getFileUrl());\n    }\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 10
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/resource/controller/ResourceController.java",
      "timestamp": 1765256360300,
      "startOffset": 1721,
      "endOffset": 1941,
      "codeContent": ",\n            @RequestParam(defaultValue \u003d \"createTime\") String orderBy) {\n        // 公开接口只返回已审核通过的资源(status\u003d1)\n        Page\u003cResourceVO\u003e page \u003d resourceService.listResources(current, size, categoryId, keyword, 1, orderBy",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 4
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/resource/service/impl/ResourceServiceImpl.java",
      "timestamp": 1765256420338,
      "startOffset": 4541,
      "endOffset": 5756,
      "codeContent": "// 默认按创建时间排序\n        return listResources(current, size, categoryId, keyword, status, \"createTime\");\n    }\n\n    @Override\n    public Page\u003cResourceVO\u003e listResources(Integer current, Integer size, Long categoryId, String keyword,\n            Integer status, String orderBy) {\n        Page\u003cResource\u003e page \u003d new Page\u003c\u003e(current, size);\n        LambdaQueryWrapper\u003cResource\u003e wrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n\n        // 状态筛选\n        if (status !\u003d null) {\n            wrapper.eq(Resource::getStatus, status);\n        }\n\n        // 分类筛选\n        if (categoryId !\u003d null) {\n            wrapper.eq(Resource::getCategoryId, categoryId);\n        }\n\n        // 关键词搜索\n        if (StrUtil.isNotBlank(keyword)) {\n            wrapper.and(w -\u003e w.like(Resource::getTitle, keyword)\n                    .or().like(Resource::getDescription, keyword)\n                    .or().like(Resource::getTags, keyword));\n        }\n\n        // 排序\n        if (\"viewCount\".equals(orderBy)) {\n            wrapper.orderByDesc(Resource::getViewCount);\n        } else if (\"downloadCount\".equals(orderBy)) {\n            wrapper.orderByDesc(Resource::getDownloadCount);\n        } else {\n            wrapper.orderByDesc(Resource::getCreateTime);\n        }",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 35
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/course/service/impl/CourseServiceImpl.java",
      "timestamp": 1765256831570,
      "startOffset": 1616,
      "endOffset": 2182,
      "codeContent": "关键词搜索 - 搜索标题和简介\n        if (StrUtil.isNotBlank(queryDTO.getKeyword())) {\n            wrapper.and(w -\u003e w.like(Course::getTitle, queryDTO.getKeyword())\n                    .or().like(Course::getIntro, queryDTO.getKeyword()));\n        }\n\n        // 排序\n        String orderBy \u003d queryDTO.getOrderBy();\n        if (\"studyCount\".equals(orderBy)) {\n            wrapper.orderByDesc(Course::getStudyCount);\n        } else {\n            // 默认按创建时间排序，推荐优先\n            wrapper.orderByDesc(Course::getIsRecommend)\n                    .orderByDesc(Course::getCreateTime);\n        }",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 15
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/exam/controller/ExamController.java",
      "timestamp": 1765256861600,
      "startOffset": 1193,
      "endOffset": 1336,
      "codeContent": ",\n            @RequestParam(required \u003d false) String keyword) {\n        Page\u003cExam\u003e page \u003d examService.listAvailableExams(current, size, keyword",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 3
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/exam/service/impl/ExamServiceImpl.java",
      "timestamp": 1765256936648,
      "startOffset": 1570,
      "endOffset": 2127,
      "codeContent": "return listAvailableExams(current, size, null);\n    }\n\n    @Override\n    public Page\u003cExam\u003e listAvailableExams(Integer current, Integer size, String keyword) {\n        Page\u003cExam\u003e page \u003d new Page\u003c\u003e(current, size);\n        LambdaQueryWrapper\u003cExam\u003e wrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n        wrapper.eq(Exam::getStatus, 1); // 只查询启用的试卷\n\n        // 关键词搜索 - 搜索名称和描述\n        if (keyword !\u003d null \u0026\u0026 !keyword.trim().isEmpty()) {\n            wrapper.and(w -\u003e w.like(Exam::getName, keyword)\n                    .or().like(Exam::getDescription, keyword));\n        }\n",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 15
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/community/service/impl/PostServiceImpl.java",
      "timestamp": 1765257502930,
      "startOffset": 2240,
      "endOffset": 2737,
      "codeContent": "keyword, String orderBy) {\n        Page\u003cPost\u003e page \u003d new Page\u003c\u003e(current, size);\n        LambdaQueryWrapper\u003cPost\u003e wrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n\n        wrapper.eq(Post::getStatus, 1);\n\n        // 话题精确筛选\n        if (StrUtil.isNotBlank(topic)) {\n            wrapper.eq(Post::getTopic, topic);\n        }\n\n        // 关键词模糊搜索（标题或内容）\n        if (StrUtil.isNotBlank(keyword)) {\n            wrapper.and(w -\u003e w.like(Post::getTitle, keyword)\n                    .or().like(Post::getContent, keyword)",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 15
    },
    {
      "filePath": "C:/Users/vv/Desktop/service/dm-cloud-parent/dm-user-consumer/src/main/java/dm/cn/UserConsumerApplication.java",
      "timestamp": 1765264624371,
      "startOffset": 23,
      "endOffset": 551,
      "codeContent": "dm.cn.config.RandomLoadBalancerConfig;\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.loadbalancer.annotation.LoadBalancerClient;\nimport org.springframework.cloud.openfeign.EnableFeignClients;\n\n/**\n * 用户服务消费者启动类\n * 整合 Spring Cloud LoadBalancer 实现负载均衡\n * 使用 RandomLoadBalancer 随机策略\n */\n@SpringBootApplication\n@EnableFeignClients\n@LoadBalancerClient(name \u003d \"dm-user-provider\", configuration \u003d RandomLoadBalancerConfig.class)",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 14
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/course/service/impl/StudyRecordServiceImpl.java",
      "timestamp": 1765785148486,
      "startOffset": 8855,
      "endOffset": 9083,
      "codeContent": "// 10. 计算学习勤奋度（0-5星）\n        // 以120分钟（2小时）日均学习为满分5星\n        double diligenceScore \u003d Math.min(5.0, (avgDaily / 120.0) * 5.0);\n        report.setDiligenceScore(Double.parseDouble(String.format(\"%.1f\", diligenceScore)));\n\n        ",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 6
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/user/mapper/LoginLogMapper.java",
      "timestamp": 1765785755569,
      "startOffset": 194,
      "endOffset": 575,
      "codeContent": "Delete;\nimport org.apache.ibatis.annotations.Mapper;\nimport org.apache.ibatis.annotations.Param;\n\nimport java.time.LocalDateTime;\n\n@Mapper\npublic interface LoginLogMapper extends BaseMapper\u003cLoginLog\u003e {\n\n    /**\n     * 删除指定时间之前的登录日志\n     */\n    @Delete(\"DELETE FROM login_log WHERE login_time \u003c #{beforeTime}\")\n    int deleteOlderThan(@Param(\"beforeTime\") LocalDateTime beforeTime);",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 14
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/RedEducationApplication.java",
      "timestamp": 1765785830688,
      "startOffset": 197,
      "endOffset": 326,
      "codeContent": "import org.springframework.scheduling.annotation.EnableScheduling;\n\n/**\n * 红色教育平台启动类\n */\n@SpringBootApplication\n@EnableScheduling",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 7
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/admin/controller/AdminStatisticsController.java",
      "timestamp": 1765955047587,
      "startOffset": 885,
      "endOffset": 914,
      "codeContent": "AnyRole(\u0027SYS_ADMIN\u0027, \u0027CONTENT",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/admin/service/impl/AdminStatisticsServiceImpl.java",
      "timestamp": 1765955784425,
      "startOffset": 412,
      "endOffset": 7432,
      "codeContent": "entity.Course;\nimport com.red.education.module.course.mapper.CourseMapper;\nimport com.red.education.module.exam.mapper.ExamMapper;\nimport com.red.education.module.resource.entity.Resource;\nimport com.red.education.module.resource.mapper.ResourceMapper;\nimport com.red.education.module.user.entity.User;\nimport com.red.education.module.user.mapper.UserMapper;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport java.time.LocalDate;\nimport java.time.LocalDateTime;\nimport java.time.YearMonth;\n\n/**\n * 后台统计服务实现\n */\n@Service\npublic class AdminStatisticsServiceImpl implements AdminStatisticsService {\n\n    @Autowired\n    private UserMapper userMapper;\n\n    @Autowired\n    private ResourceMapper resourceMapper;\n\n    @Autowired\n    private CourseMapper courseMapper;\n\n    @Autowired\n    private PostMapper postMapper;\n\n    @Autowired\n    private ExamMapper examMapper;\n\n    @Override\n    public DashboardStatsVO getDashboardStats() {\n        DashboardStatsVO stats \u003d new DashboardStatsVO();\n\n        // 统计总用户数\n        stats.setTotalUsers(userMapper.selectCount(null));\n\n        // 统计总资源数\n        stats.setTotalResources(resourceMapper.selectCount(null));\n\n        // 统计总课程数\n        stats.setTotalCourses(courseMapper.selectCount(null));\n\n        // 统计总帖子数\n        stats.setTotalPosts(postMapper.selectCount(null));\n\n        // 统计总试卷数\n        stats.setTotalExams(examMapper.selectCount(null));\n\n        // 统计待审核帖子数（status \u003d 0）\n        LambdaQueryWrapper\u003cPost\u003e postWrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n        postWrapper.eq(Post::getStatus, 0);\n        stats.setPendingPosts(postMapper.selectCount(postWrapper));\n\n        // 统计待审核资源数（status \u003d 0）\n        LambdaQueryWrapper\u003cResource\u003e resourceWrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n        resourceWrapper.eq(Resource::getStatus, 0);\n        stats.setPendingResources(resourceMapper.selectCount(resourceWrapper));\n\n        // 在线用户数和今日访问量暂时设置为0（需要Redis或其他缓存支持）\n        stats.setOnlineUsers(0);\n        stats.setTodayVisits(0);\n\n        // 计算过去6个月的用户增长数据\n        stats.setUserGrowthData(calculateUserGrowth());\n\n        // 计算环比增长率\n        stats.setUserGrowthRate(calculateUserGrowthRate());\n        stats.setResourceGrowthRate(calculateResourceGrowthRate());\n        stats.setCourseGrowthRate(calculateCourseGrowthRate());\n        stats.setPostGrowthRate(calculatePostGrowthRate());\n\n        return stats;\n    }\n\n    /**\n     * 计算过去6个月的用户增长数据\n     */\n    private int[] calculateUserGrowth() {\n        int[] growth \u003d new int[6];\n        LocalDate today \u003d LocalDate.now();\n\n        for (int i \u003d 5; i \u003e\u003d 0; i--) {\n            YearMonth month \u003d YearMonth.from(today.minusMonths(i));\n            LocalDateTime startOfMonth \u003d month.atDay(1).atStartOfDay();\n            LocalDateTime endOfMonth \u003d month.atEndOfMonth().atTime(23, 59, 59);\n\n            LambdaQueryWrapper\u003cUser\u003e wrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n            wrapper.between(User::getCreateTime, startOfMonth, endOfMonth);\n            growth[5 - i] \u003d Math.toIntExact(userMapper.selectCount(wrapper));\n        }\n\n        return growth;\n    }\n\n    /**\n     * 计算用户环比增长率\n     */\n    private Double calculateUserGrowthRate() {\n        LocalDate today \u003d LocalDate.now();\n        YearMonth currentMonth \u003d YearMonth.from(today);\n        YearMonth lastMonth \u003d currentMonth.minusMonths(1);\n\n        long currentCount \u003d countUsersByMonth(currentMonth);\n        long lastCount \u003d countUsersByMonth(lastMonth);\n\n        return calculateGrowthRate(currentCount, lastCount);\n    }\n\n    /**\n     * 计算资源环比增长率\n     */\n    private Double calculateResourceGrowthRate() {\n        LocalDate today \u003d LocalDate.now();\n        YearMonth currentMonth \u003d YearMonth.from(today);\n        YearMonth lastMonth \u003d currentMonth.minusMonths(1);\n\n        long currentCount \u003d countResourcesByMonth(currentMonth);\n        long lastCount \u003d countResourcesByMonth(lastMonth);\n\n        return calculateGrowthRate(currentCount, lastCount);\n    }\n\n    /**\n     * 计算课程环比增长率\n     */\n    private Double calculateCourseGrowthRate() {\n        LocalDate today \u003d LocalDate.now();\n        YearMonth currentMonth \u003d YearMonth.from(today);\n        YearMonth lastMonth \u003d currentMonth.minusMonths(1);\n\n        long currentCount \u003d countCoursesByMonth(currentMonth);\n        long lastCount \u003d countCoursesByMonth(lastMonth);\n\n        return calculateGrowthRate(currentCount, lastCount);\n    }\n\n    /**\n     * 计算帖子环比增长率\n     */\n    private Double calculatePostGrowthRate() {\n        LocalDate today \u003d LocalDate.now();\n        YearMonth currentMonth \u003d YearMonth.from(today);\n        YearMonth lastMonth \u003d currentMonth.minusMonths(1);\n\n        long currentCount \u003d countPostsByMonth(currentMonth);\n        long lastCount \u003d countPostsByMonth(lastMonth);\n\n        return calculateGrowthRate(currentCount, lastCount);\n    }\n\n    /**\n     * 统计指定月份新增用户数\n     */\n    private long countUsersByMonth(YearMonth month) {\n        LocalDateTime startOfMonth \u003d month.atDay(1).atStartOfDay();\n        LocalDateTime endOfMonth \u003d month.atEndOfMonth().atTime(23, 59, 59);\n\n        LambdaQueryWrapper\u003cUser\u003e wrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n        wrapper.between(User::getCreateTime, startOfMonth, endOfMonth);\n        return userMapper.selectCount(wrapper);\n    }\n\n    /**\n     * 统计指定月份新增资源数\n     */\n    private long countResourcesByMonth(YearMonth month) {\n        LocalDateTime startOfMonth \u003d month.atDay(1).atStartOfDay();\n        LocalDateTime endOfMonth \u003d month.atEndOfMonth().atTime(23, 59, 59);\n\n        LambdaQueryWrapper\u003cResource\u003e wrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n        wrapper.between(Resource::getCreateTime, startOfMonth, endOfMonth);\n        return resourceMapper.selectCount(wrapper);\n    }\n\n    /**\n     * 统计指定月份新增课程数\n     */\n    private long countCoursesByMonth(YearMonth month) {\n        LocalDateTime startOfMonth \u003d month.atDay(1).atStartOfDay();\n        LocalDateTime endOfMonth \u003d month.atEndOfMonth().atTime(23, 59, 59);\n\n        LambdaQueryWrapper\u003cCourse\u003e wrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n        wrapper.between(Course::getCreateTime, startOfMonth, endOfMonth);\n        return courseMapper.selectCount(wrapper);\n    }\n\n    /**\n     * 统计指定月份新增帖子数\n     */\n    private long countPostsByMonth(YearMonth month) {\n        LocalDateTime startOfMonth \u003d month.atDay(1).atStartOfDay();\n        LocalDateTime endOfMonth \u003d month.atEndOfMonth().atTime(23, 59, 59);\n\n        LambdaQueryWrapper\u003cPost\u003e wrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n        wrapper.between(Post::getCreateTime, startOfMonth, endOfMonth);\n        return postMapper.selectCount(wrapper);\n    }\n\n    /**\n     * 计算环比增长率\n     * \n     * @param current 本期数量\n     * @param last    上期数量\n     * @return 增长率百分比，如 12.5 表示增长12.5%\n     */\n    private Double calculateGrowthRate(long current, long last) {\n        if (last \u003d\u003d 0) {\n            // 上期为0，本期有数据则返回100%，无数据返回0%\n            return current \u003e 0 ? 100.0 : 0.0;\n        }\n        double rate \u003d ((double) (current - last) / last) * 100;\n        // 保留一位小数\n        return Math.round(rate * 10) / 10.0",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 219
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/course/service/StudyRecordService.java",
      "timestamp": 1765959604716,
      "startOffset": 711,
      "endOffset": 841,
      "codeContent": "（包含课程信息）\n     *\n     * @param userId 用户ID\n     * @return 学习历史列表\n     */\n    List\u003ccom.red.education.module.course.vo.StudyHistoryVO",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 6
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/course/service/impl/StudyRecordServiceImpl.java",
      "timestamp": 1765959694763,
      "startOffset": 5551,
      "endOffset": 7054,
      "codeContent": "com.red.education.module.course.vo.StudyHistoryVO\u003e getUserStudyHistory(Long userId) {\n        LambdaQueryWrapper\u003cStudyRecord\u003e wrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n        wrapper.eq(StudyRecord::getUserId, userId)\n                .orderByDesc(StudyRecord::getUpdateTime);\n        List\u003cStudyRecord\u003e records \u003d this.list(wrapper);\n\n        // 转换为VO，并关联课程信息\n        return records.stream().map(record -\u003e {\n            com.red.education.module.course.vo.StudyHistoryVO vo \u003d new com.red.education.module.course.vo.StudyHistoryVO();\n            vo.setId(record.getId());\n            vo.setUserId(record.getUserId());\n            vo.setCourseId(record.getCourseId());\n            vo.setStudyTime(record.getStudyTime());\n            vo.setTotalDuration(record.getStudyTime()); // 总学习时长（分钟）\n            vo.setProgress(record.getProgress());\n            vo.setIsCompleted(record.getIsCompleted());\n            vo.setLastPosition(record.getLastPosition());\n            vo.setLastStudyTime(record.getUpdateTime());\n            vo.setCreateTime(record.getCreateTime());\n\n            // 获取课程信息\n            Course course \u003d courseMapper.selectById(record.getCourseId());\n            if (course !\u003d null) {\n                vo.setCourseTitle(course.getTitle());\n                vo.setCourseCover(course.getCoverImage());\n                // TODO: 如果有章节表，可以查询章节数量\n                vo.setTotalChapters(0);\n                vo.setCompletedChapters(0);\n            }\n\n            return vo;\n        }).collect(Collectors.toList()",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 32
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/course/controller/StudyRecordController.java",
      "timestamp": 1765959709785,
      "startOffset": 1633,
      "endOffset": 1682,
      "codeContent": "com.red.education.module.course.vo.StudyHistoryVO",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 1
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/course/service/impl/StudyRecordServiceImpl.java",
      "timestamp": 1765960222529,
      "startOffset": 5905,
      "endOffset": 7102,
      "codeContent": "，过滤掉已删除的课程\n        return records.stream().map(record -\u003e {\n            // 获取课程信息\n            Course course \u003d courseMapper.selectById(record.getCourseId());\n            if (course \u003d\u003d null) {\n                // 课程已被删除，跳过此记录\n                return null;\n            }\n\n            com.red.education.module.course.vo.StudyHistoryVO vo \u003d new com.red.education.module.course.vo.StudyHistoryVO();\n            vo.setId(record.getId());\n            vo.setUserId(record.getUserId());\n            vo.setCourseId(record.getCourseId());\n            vo.setStudyTime(record.getStudyTime());\n            vo.setTotalDuration(record.getStudyTime()); // 总学习时长（分钟）\n            vo.setProgress(record.getProgress());\n            vo.setIsCompleted(record.getIsCompleted());\n            vo.setLastPosition(record.getLastPosition());\n            vo.setLastStudyTime(record.getUpdateTime());\n            vo.setCreateTime(record.getCreateTime());\n\n            vo.setCourseTitle(course.getTitle());\n            vo.setCourseCover(course.getCoverImage());\n            // TODO: 如果有章节表，可以查询章节数量\n            vo.setTotalChapters(0);\n            vo.setCompletedChapters(0);\n\n            return vo;\n        }).filter(vo -\u003e vo !\u003d null",
      "aiProbability": 90,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 29
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/resource/service/impl/ResourceServiceImpl.java",
      "timestamp": 1765961154090,
      "startOffset": 4295,
      "endOffset": 4617,
      "codeContent": "// 先获取资源信息，以便删除关联的文件\n        Resource resource \u003d resourceMapper.selectById(resourceId);\n        if (resource !\u003d null) {\n            // 删除关联的文件\n            fileCleanupService.deleteFiles(resource.getFileUrl(), resource.getCoverImage());\n        }\n\n        resourceMapper.deleteById(resourceId);\n        log.info(\"资源{}及其关联文件",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 9
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/course/service/impl/CourseServiceImpl.java",
      "timestamp": 1765961334182,
      "startOffset": 906,
      "endOffset": 4558,
      "codeContent": "org.springframework.beans.factory.annotation.Autowired\n    private com.red.education.common.service.FileCleanupService fileCleanupService;\n\n    @Override\n    public Page\u003cCourse\u003e pageList(Page\u003cCourse\u003e page, CourseQueryDTO queryDTO) {\n        LambdaQueryWrapper\u003cCourse\u003e wrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n\n        // 查询条件\n        if (StrUtil.isNotBlank(queryDTO.getTitle())) {\n            wrapper.like(Course::getTitle, queryDTO.getTitle());\n        }\n        if (StrUtil.isNotBlank(queryDTO.getCategory())) {\n            wrapper.eq(Course::getCategory, queryDTO.getCategory());\n        }\n        if (queryDTO.getStatus() !\u003d null) {\n            wrapper.eq(Course::getStatus, queryDTO.getStatus());\n        }\n        if (queryDTO.getIsRecommend() !\u003d null) {\n            wrapper.eq(Course::getIsRecommend, queryDTO.getIsRecommend());\n        }\n\n        // 关键词搜索 - 搜索标题和简介\n        if (StrUtil.isNotBlank(queryDTO.getKeyword())) {\n            wrapper.and(w -\u003e w.like(Course::getTitle, queryDTO.getKeyword())\n                    .or().like(Course::getIntro, queryDTO.getKeyword()));\n        }\n\n        // 排序\n        String orderBy \u003d queryDTO.getOrderBy();\n        if (\"studyCount\".equals(orderBy)) {\n            wrapper.orderByDesc(Course::getCompleteCount);\n        } else {\n            // 默认按创建时间排序，推荐优先\n            wrapper.orderByDesc(Course::getIsRecommend)\n                    .orderByDesc(Course::getCreateTime);\n        }\n\n        return this.page(page, wrapper);\n    }\n\n    @Override\n    @Transactional(rollbackFor \u003d Exception.class)\n    public void createCourse(CourseDTO courseDTO) {\n        Course course \u003d new Course();\n        BeanUtil.copyProperties(courseDTO, course);\n\n        // 设置默认值\n        course.setViewCount(0);\n        course.setCompleteCount(0);\n        course.setCreateTime(LocalDateTime.now());\n        course.setUpdateTime(LocalDateTime.now());\n\n        // 如果状态为空，默认为上架\n        if (course.getStatus() \u003d\u003d null) {\n            course.setStatus(1);\n        }\n\n        this.save(course);\n    }\n\n    @Override\n    @Transactional(rollbackFor \u003d Exception.class)\n    public void updateCourse(CourseDTO courseDTO) {\n        Course course \u003d this.getById(courseDTO.getId());\n        if (course \u003d\u003d null) {\n            throw new RuntimeException(\"课程不存在\");\n        }\n\n        BeanUtil.copyProperties(courseDTO, course);\n        course.setUpdateTime(LocalDateTime.now());\n\n        this.updateById(course);\n    }\n\n    @Override\n    @Transactional(rollbackFor \u003d Exception.class)\n    public void updateStatus(Long id, Integer status) {\n        Course course \u003d this.getById(id);\n        if (course \u003d\u003d null) {\n            throw new RuntimeException(\"课程不存在\");\n        }\n\n        course.setStatus(status);\n        course.setUpdateTime(LocalDateTime.now());\n        this.updateById(course);\n    }\n\n    @Override\n    @Transactional(rollbackFor \u003d Exception.class)\n    public void addViewCount(Long id) {\n        // 使用 SQL 直接更新：update course set view_count \u003d view_count + 1 where id \u003d ?\n        // 这里为了简单使用 MyBatis-Plus 的 update\n        // 实际高并发场景建议使用 Redis 缓存计数，定时同步到数据库\n        Course course \u003d this.getById(id);\n        if (course !\u003d null) {\n            course.setViewCount(course.getViewCount() + 1);\n            this.updateById(course);\n        }\n    }\n\n    @Override\n    @Transactional(rollbackFor \u003d Exception.class)\n    public boolean removeById(Long id) {\n        // 先获取课程信息，以便删除关联的文件\n        Course course \u003d this.getById(id);\n        if (course !\u003d null) {\n            // 删除关联的文件（视频和封面图）\n            fileCleanupService.deleteFiles(course.getVideoUrl(), course.getCoverImage());\n        }\n\n        // 调用父类方法删除课程记录\n        return super.removeById(id);",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 112
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/course/mapper/DailyStudyLogMapper.java",
      "timestamp": 1765975367898,
      "startOffset": 352,
      "endOffset": 1193,
      "codeContent": "import java.util.Map;\n\n/**\n * 每日学习日志Mapper\n */\n@Mapper\npublic interface DailyStudyLogMapper extends BaseMapper\u003cDailyStudyLog\u003e {\n\n    /**\n     * 获取用户指定日期范围内的每日学习记录\n     */\n    @Select(\"SELECT * FROM daily_study_log WHERE user_id \u003d #{userId} AND study_date \u003e\u003d #{startDate} AND study_date \u003c\u003d #{endDate} ORDER BY study_date ASC\")\n    List\u003cDailyStudyLog\u003e findByUserIdAndDateRange(@Param(\"userId\") Long userId, @Param(\"startDate\") LocalDate startDate,\n            @Param(\"endDate\") LocalDate endDate);\n\n    /**\n     * 获取指定日期范围内的每日学习统计（全平台汇总）\n     */\n    @Select(\"SELECT study_date, SUM(study_minutes) as total_minutes \" +\n            \"FROM daily_study_log \" +\n            \"WHERE study_date \u003e\u003d #{startDate} AND study_date \u003c\u003d #{endDate} \" +\n            \"GROUP BY study_date ORDER BY study_date ASC\")\n    List\u003cMap\u003cString, Object\u003e\u003e getDailyStudyStats(",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 23
    },
    {
      "filePath": "C:/Users/vv/Desktop/vv/red-education-platform/src/main/java/com/red/education/module/admin/service/impl/AdminStatisticsServiceImpl.java",
      "timestamp": 1765975472929,
      "startOffset": 239,
      "endOffset": 7846,
      "codeContent": "*;\nimport com.red.education.module.community.entity.Post;\nimport com.red.education.module.community.mapper.PostMapper;\nimport com.red.education.module.course.entity.Course;\nimport com.red.education.module.course.mapper.CourseMapper;\nimport com.red.education.module.course.mapper.DailyStudyLogMapper;\nimport com.red.education.module.exam.entity.ExamScore;\nimport com.red.education.module.exam.mapper.ExamMapper;\nimport com.red.education.module.exam.mapper.ExamScoreMapper;\nimport com.red.education.module.resource.entity.Resource;\nimport com.red.education.module.resource.mapper.ResourceMapper;\nimport com.red.education.module.user.entity.User;\nimport com.red.education.module.user.mapper.UserMapper;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport java.sql.Date;\nimport java.time.LocalDate;\nimport java.time.LocalDateTime;\nimport java.time.YearMonth;\nimport java.time.format.DateTimeFormatter;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.Map;\n\n/**\n * 后台统计服务实现\n */\n@Service\npublic class AdminStatisticsServiceImpl implements AdminStatisticsService {\n\n    @Autowired\n    private UserMapper userMapper;\n\n    @Autowired\n    private ResourceMapper resourceMapper;\n\n    @Autowired\n    private CourseMapper courseMapper;\n\n    @Autowired\n    private PostMapper postMapper;\n\n    @Autowired\n    private ExamMapper examMapper;\n\n    @Autowired\n    private DailyStudyLogMapper dailyStudyLogMapper;\n\n    @Autowired\n    private ExamScoreMapper examScoreMapper;\n\n    @Override\n    public DashboardStatsVO getDashboardStats() {\n        DashboardStatsVO stats \u003d new DashboardStatsVO();\n\n        // 统计总用户数\n        stats.setTotalUsers(userMapper.selectCount(null));\n\n        // 统计总资源数\n        stats.setTotalResources(resourceMapper.selectCount(null));\n\n        // 统计总课程数\n        stats.setTotalCourses(courseMapper.selectCount(null));\n\n        // 统计总帖子数\n        stats.setTotalPosts(postMapper.selectCount(null));\n\n        // 统计总试卷数\n        stats.setTotalExams(examMapper.selectCount(null));\n\n        // 统计待审核帖子数（status \u003d 0）\n        LambdaQueryWrapper\u003cPost\u003e postWrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n        postWrapper.eq(Post::getStatus, 0);\n        stats.setPendingPosts(postMapper.selectCount(postWrapper));\n\n        // 统计待审核资源数（status \u003d 0）\n        LambdaQueryWrapper\u003cResource\u003e resourceWrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n        resourceWrapper.eq(Resource::getStatus, 0);\n        stats.setPendingResources(resourceMapper.selectCount(resourceWrapper));\n\n        // 在线用户数和今日访问量暂时设置为0（需要Redis或其他缓存支持）\n        stats.setOnlineUsers(0);\n        stats.setTodayVisits(0);\n\n        // 计算过去6个月的用户增长数据\n        stats.setUserGrowthData(calculateUserGrowth());\n\n        // 计算环比增长率\n        stats.setUserGrowthRate(calculateUserGrowthRate());\n        stats.setResourceGrowthRate(calculateResourceGrowthRate());\n        stats.setCourseGrowthRate(calculateCourseGrowthRate());\n        stats.setPostGrowthRate(calculatePostGrowthRate());\n\n        // 新增：学习活跃度数据\n        stats.setStudyActivityData(getStudyActivityData());\n\n        // 新增：考试通过率统计\n        stats.setExamPassRate(getExamPassRate());\n\n        // 新增：热门资源/课程\n        stats.setPopularItems(getPopularItems());\n\n        return stats;\n    }\n\n    /**\n     * 获取学习活跃度数据（近30天）\n     */\n    private List\u003cStudyActivityVO\u003e getStudyActivityData() {\n        LocalDate endDate \u003d LocalDate.now();\n        LocalDate startDate \u003d endDate.minusDays(29); // 包含今天共30天\n\n        List\u003cMap\u003cString, Object\u003e\u003e dbResults \u003d dailyStudyLogMapper.getDailyStudyStats(startDate, endDate);\n\n        // 创建完整的30天数据，初始化为0\n        List\u003cStudyActivityVO\u003e activityList \u003d new ArrayList\u003c\u003e();\n        DateTimeFormatter formatter \u003d DateTimeFormatter.ofPattern(\"MM-dd\");\n\n        for (int i \u003d 0; i \u003c 30; i++) {\n            LocalDate date \u003d startDate.plusDays(i);\n            String dateStr \u003d date.format(formatter);\n\n            // 查找数据库中是否有该日期的数据\n            Integer minutes \u003d 0;\n            for (Map\u003cString, Object\u003e result : dbResults) {\n                Object studyDateObj \u003d result.get(\"study_date\");\n                LocalDate studyDate;\n\n                if (studyDateObj instanceof Date) {\n                    studyDate \u003d ((Date) studyDateObj).toLocalDate();\n                } else if (studyDateObj instanceof LocalDate) {\n                    studyDate \u003d (LocalDate) studyDateObj;\n                } else {\n                    continue;\n                }\n\n                if (studyDate.equals(date)) {\n                    Object minutesObj \u003d result.get(\"total_minutes\");\n                    if (minutesObj instanceof Number) {\n                        minutes \u003d ((Number) minutesObj).intValue();\n                    }\n                    break;\n                }\n            }\n\n            activityList.add(new StudyActivityVO(dateStr, minutes));\n        }\n\n        return activityList;\n    }\n\n    /**\n     * 获取考试通过率统计\n     */\n    private ExamPassRateVO getExamPassRate() {\n        ExamPassRateVO vo \u003d new ExamPassRateVO();\n\n        // 统计总考试次数\n        Long totalExams \u003d examScoreMapper.selectCount(null);\n        vo.setTotalExams(totalExams);\n\n        if (totalExams \u003d\u003d 0) {\n            vo.setPassCount(0L);\n            vo.setFailCount(0L);\n            vo.setPassRate(0.0);\n            return vo;\n        }\n\n        // 统计及格次数（pass \u003d 1）\n        LambdaQueryWrapper\u003cExamScore\u003e passWrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n        passWrapper.eq(ExamScore::getPass, 1);\n        Long passCount \u003d examScoreMapper.selectCount(passWrapper);\n        vo.setPassCount(passCount);\n\n        // 统计不及格次数\n        Long failCount \u003d totalExams - passCount;\n        vo.setFailCount(failCount);\n\n        // 计算通过率\n        double passRate \u003d (passCount.doubleValue() / totalExams.doubleValue()) * 100;\n        vo.setPassRate(Math.round(passRate * 10) / 10.0); // 保留一位小数\n\n        return vo;\n    }\n\n    /**\n     * 获取热门资源/课程列表\n     */\n    private List\u003cPopularItemVO\u003e getPopularItems() {\n        List\u003cPopularItemVO\u003e items \u003d new ArrayList\u003c\u003e();\n\n        // 查询Top 5热门资源（按下载量排序，只要已通过的）\n        LambdaQueryWrapper\u003cResource\u003e resourceWrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n        resourceWrapper.eq(Resource::getStatus, 1)\n                .orderByDesc(Resource::getDownloadCount)\n                .last(\"LIMIT 5\");\n        List\u003cResource\u003e topResources \u003d resourceMapper.selectList(resourceWrapper);\n\n        for (Resource resource : topResources) {\n            PopularItemVO item \u003d new PopularItemVO();\n            item.setId(resource.getId());\n            item.setTitle(resource.getTitle());\n            item.setType(\"resource\");\n            item.setCount(resource.getDownloadCount());\n            item.setCoverImage(resource.getCoverImage());\n            items.add(item);\n        }\n\n        // 查询Top 5热门课程（按浏览量排序，只要已发布的）\n        LambdaQueryWrapper\u003cCourse\u003e courseWrapper \u003d new LambdaQueryWrapper\u003c\u003e();\n        courseWrapper.eq(Course::getStatus, 1)\n                .orderByDesc(Course::getViewCount)\n                .last(\"LIMIT 5\");\n        List\u003cCourse\u003e topCourses \u003d courseMapper.selectList(courseWrapper);\n\n        for (Course course : topCourses) {\n            PopularItemVO item \u003d new PopularItemVO();\n            item.setId(course.getId());\n            item.setTitle(course.getTitle());\n            item.setType(\"course\");\n            item.setCount(course.getViewCount());\n            item.setCoverImage(course.getCoverImage());\n            items.add(item);\n        }\n\n        // 按count降序排序，取前10个\n        items.sort((a, b) -\u003e b.getCount().compareTo(a.getCount()));\n        if (items.size() \u003e 10) {\n            items \u003d items.subList(0, 10);\n        }\n\n        return item",
      "aiProbability": 95,
      "aiTool": "AI Assistant",
      "detectionMethod": "REALTIME_SPEED_ANALYSIS",
      "lineCount": 233
    }
  ],
  "toolStats": {
    "AI Assistant": {
      "usageCount": 22,
      "totalLines": 815
    }
  }
}